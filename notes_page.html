<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Notes</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: #11183a;
      --muted: #8aa4ff;
      --text: #eef1ff;
      --accent: #5b76ff;
      --accent-2: #9ec1ff;
      --danger: #ff6b6b;
      --ok: #27d796;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1400px 800px at 70% -10%, #122060, transparent 60%), var(--bg);
      color: var(--text);
    }

    header {
      position: sticky; top: 0; z-index: 5;
      backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(11,16,32,.9), rgba(11,16,32,.5));
      border-bottom: 1px solid rgba(255,255,255,.08);
      padding: 14px 18px;
      display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center;
    }

    .brand { font-weight: 700; letter-spacing: .3px; }
    .brand small { color: var(--muted); font-weight: 500; }

    .toolbar { display: flex; gap: 8px; flex-wrap: wrap; }

    .container { max-width: 1100px; margin: 20px auto; padding: 0 16px; }

    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px; padding: 16px; box-shadow: var(--shadow);
    }

    .grid { display: grid; grid-template-columns: 1.2fr .8fr; gap: 16px; }
    @media (max-width: 920px) { .grid { grid-template-columns: 1fr; } }

    label { display: block; font-size: 13px; color: var(--accent-2); margin: 14px 0 6px; }

    input[type="text"], input[type="url"], textarea {
      width: 100%; border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25); color: var(--text);
      border-radius: 12px; padding: 12px 14px; outline: none; font-size: 15px;
    }
    textarea { min-height: 140px; resize: vertical; }

    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .row3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
    @media (max-width: 700px) { .row, .row3 { grid-template-columns: 1fr; } }

    .btn {
      appearance: none; border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, #3347ff, #2736c2);
      color: white; padding: 10px 14px; border-radius: 12px; cursor: pointer;
      font-weight: 600; box-shadow: var(--shadow);
    }
    .btn.secondary { background: rgba(255,255,255,.08); color: var(--accent-2); }
    .btn.ghost { background: transparent; border-color: rgba(255,255,255,.18); color: var(--accent-2); }
    .btn.danger { background: linear-gradient(180deg, #ff7575, #c43a3a); }

    .note-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px; }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px; overflow: hidden; position: relative;
      display: flex; flex-direction: column;
    }
    .thumb { width: 100%; aspect-ratio: 16/9; object-fit: cover; background: #0c1330; }
    .content { padding: 12px 12px 16px; }
    .title { font-weight: 700; margin: 2px 0 8px; }
    .meta { font-size: 12px; color: #c9d3ff; display: flex; gap: 8px; flex-wrap: wrap; }
    .body { white-space: pre-wrap; margin: 8px 0 10px; line-height: 1.45; }

    .card .actions { display: flex; gap: 8px; padding: 0 12px 12px; }

    .filters { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

    .pill { font-size: 12px; padding: 4px 8px; border-radius: 999px; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.12); }

    .muted { color: #a7b5ff; }
    .right { margin-left: auto; }
    .hidden { display: none; }
    .link { text-decoration: none; color: #e5ecff; }

    footer { text-align: center; padding: 20px; color: #a7b5ff; }
  </style>
</head>
<body>
  <header>
    <div class="brand">My Notes <small>• offline-first (saved in your browser)</small></div>
    <div class="toolbar">
      <button id="exportBtn" class="btn secondary" title="Download your notes as JSON">Export</button>
      <label for="importFile" class="btn ghost" title="Import notes from a JSON file">Import</label>
      <input id="importFile" type="file" accept="application/json" class="hidden" />
      <button id="clearAllBtn" class="btn danger" title="Delete ALL notes">Clear All</button>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <section class="panel">
        <h2 style="margin:0 0 6px">Add / Edit Note</h2>
        <p class="muted" style="margin-top:0">Tip: store images in your repo's <code>images/</code> folder and use a relative URL like <code>images/pic.jpg</code>.</p>
        <div class="row">
          <div>
            <label>Title</label>
            <input id="title" type="text" placeholder="e.g., ISE Troubleshooting Tips" />
          </div>
          <div>
            <label>Tags (comma separated)</label>
            <input id="tags" type="text" placeholder="ise, radius, aaa" />
          </div>
        </div>
        <label>Body (plain text or quick notes)</label>
        <textarea id="body" placeholder="Write your notes here..."></textarea>
        <div class="row3">
          <div>
            <label>Image URL (optional)</label>
            <input id="imageUrl" type="url" placeholder="images/screenshot.png or https://..." />
          </div>
          <div>
            <label>Link URL (optional)</label>
            <input id="linkUrl" type="url" placeholder="https://useful-link.example" />
          </div>
          <div>
            <label>&nbsp;</label>
            <button id="saveBtn" class="btn" style="width:100%">Save Note</button>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="filters">
          <input id="search" type="text" placeholder="Search in titles, body, tags..." />
          <span class="pill right" id="countPill">0 notes</span>
        </div>
        <div class="note-list" id="noteList" style="margin-top:12px"></div>
      </section>
    </div>

    <footer>
      Built for GitHub Pages · Your notes are saved in <strong>localStorage</strong>. Use <em>Export</em> to sync across devices.
    </footer>
  </main>

  <script>
    // --- Storage helpers ---
    const KEY = 'my-notes-v1';
    const $ = (sel) => document.querySelector(sel);

    function readNotes() {
      try { return JSON.parse(localStorage.getItem(KEY)) || []; } catch { return []; }
    }
    function writeNotes(notes) {
      localStorage.setItem(KEY, JSON.stringify(notes));
      render();
    }

    // --- UI elements ---
    const titleEl = $('#title');
    const bodyEl = $('#body');
    const tagsEl = $('#tags');
    const imageUrlEl = $('#imageUrl');
    const linkUrlEl = $('#linkUrl');
    const listEl = $('#noteList');
    const countPill = $('#countPill');
    const searchEl = $('#search');
    const saveBtn = $('#saveBtn');

    let editingId = null; // when set, Save updates the note

    function createNoteCard(note) {
      const card = document.createElement('article');
      card.className = 'card';

      // Image
      const imgSrc = note.imageUrl?.trim();
      if (imgSrc) {
        const img = document.createElement('img');
        img.className = 'thumb';
        img.loading = 'lazy';
        img.alt = note.title || 'note image';
        img.src = imgSrc;
        card.appendChild(img);
      }

      // Content
      const content = document.createElement('div');
      content.className = 'content';

      const title = document.createElement('div');
      title.className = 'title';
      title.textContent = note.title || '(Untitled)';
      content.appendChild(title);

      const meta = document.createElement('div');
      meta.className = 'meta';
      const date = new Date(note.updatedAt || note.createdAt);
      meta.innerHTML = `<span>${date.toLocaleString()}</span>`;
      if (note.tags?.length) {
        meta.innerHTML += `<span>• ${note.tags.join(', ')}</span>`;
      }
      content.appendChild(meta);

      const body = document.createElement('div');
      body.className = 'body';
      body.textContent = note.body || '';
      content.appendChild(body);

      if (note.linkUrl) {
        const a = document.createElement('a');
        a.href = note.linkUrl; a.target = '_blank'; a.rel = 'noopener';
        a.className = 'link'; a.textContent = 'Open link ↗';
        content.appendChild(a);
      }

      card.appendChild(content);

      // Actions
      const actions = document.createElement('div');
      actions.className = 'actions';

      const editBtn = document.createElement('button');
      editBtn.className = 'btn secondary';
      editBtn.textContent = 'Edit';
      editBtn.onclick = () => {
        editingId = note.id;
        titleEl.value = note.title || '';
        bodyEl.value = note.body || '';
        tagsEl.value = (note.tags || []).join(', ');
        imageUrlEl.value = note.imageUrl || '';
        linkUrlEl.value = note.linkUrl || '';
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };

      const delBtn = document.createElement('button');
      delBtn.className = 'btn danger';
      delBtn.textContent = 'Delete';
      delBtn.onclick = () => {
        if (!confirm('Delete this note?')) return;
        const notes = readNotes().filter(n => n.id !== note.id);
        writeNotes(notes);
      };

      actions.append(editBtn, delBtn);
      card.appendChild(actions);

      return card;
    }

    function render() {
      const q = searchEl.value.trim().toLowerCase();
      const notes = readNotes()
        .sort((a,b) => (b.updatedAt||b.createdAt) - (a.updatedAt||a.createdAt));

      const filtered = q
        ? notes.filter(n =>
            (n.title||'').toLowerCase().includes(q) ||
            (n.body||'').toLowerCase().includes(q) ||
            (n.tags||[]).join(',').toLowerCase().includes(q)
          )
        : notes;

      listEl.innerHTML = '';
      filtered.forEach(n => listEl.appendChild(createNoteCard(n)));
      const count = filtered.length;
      countPill.textContent = `${count} note${count===1?'':'s'}`;
    }

    function saveNote() {
      const title = titleEl.value.trim();
      const body = bodyEl.value.trim();
      const tags = tagsEl.value.split(',').map(t => t.trim()).filter(Boolean);
      const imageUrl = imageUrlEl.value.trim();
      const linkUrl = linkUrlEl.value.trim();

      const now = Date.now();
      const notes = readNotes();

      if (editingId) {
        const idx = notes.findIndex(n => n.id === editingId);
        if (idx !== -1) {
          notes[idx] = { ...notes[idx], title, body, tags, imageUrl, linkUrl, updatedAt: now };
        }
        editingId = null;
      } else {
        const note = { id: crypto.randomUUID(), title, body, tags, imageUrl, linkUrl, createdAt: now };
        notes.push(note);
      }

      // Clear form
      titleEl.value = bodyEl.value = imageUrlEl.value = linkUrlEl.value = '';
      tagsEl.value = '';

      writeNotes(notes);
    }

    // Export / Import / Clear
    function exportNotes() {
      const data = JSON.stringify(readNotes(), null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'my-notes.json'; a.click();
      URL.revokeObjectURL(url);
    }

    async function importNotes(file) {
      const text = await file.text();
      let incoming = [];
      try { incoming = JSON.parse(text); } catch { alert('Invalid JSON'); return; }
      if (!Array.isArray(incoming)) { alert('Invalid file format'); return; }
      const existing = readNotes();
      const merged = [...existing];
      for (const note of incoming) {
        if (!note.id) note.id = crypto.randomUUID();
        const idx = merged.findIndex(n => n.id === note.id);
        if (idx === -1) merged.push(note); else merged[idx] = note;
      }
      writeNotes(merged);
    }

    function clearAll() {
      if (!confirm('This will delete ALL notes stored in this browser. Continue?')) return;
      localStorage.removeItem(KEY);
      render();
    }

    // Wire up
    saveBtn.addEventListener('click', saveNote);
    $('#exportBtn').addEventListener('click', exportNotes);
    $('#importFile').addEventListener('change', (e) => {
      const file = e.target.files[0]; if (file) importNotes(file);
      e.target.value = '';
    });
    $('#clearAllBtn').addEventListener('click', clearAll);
    searchEl.addEventListener('input', render);

    // Initial render
    render();
  </script>
</body>
</html>
